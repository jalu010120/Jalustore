<!DOCTYPE html>
<html lang="id">
<head>
  <!-- [Previous head content remains exactly the same until the closing </style> tag] -->
  <style>
    /* [All previous CSS remains exactly the same] */
    
    /* Add these new styles at the end of the style section */
    
    /* Skeleton Loading */
    .skeleton {
      animation: skeleton-loading 1.5s infinite ease-in-out;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      border-radius: 4px;
    }
    
    @keyframes skeleton-loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .skeleton-card {
      height: 120px;
      width: 100%;
      margin-bottom: 1rem;
    }
    
    /* Debounce indicator */
    .search-debounce {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--sky-blue-medium);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .search-debounce.visible {
      opacity: 1;
    }
    
    /* Enhanced modal transitions */
    .modal-content {
      will-change: transform;
    }
    
    /* Better card transitions */
    .card {
      will-change: transform;
    }
  </style>
</head>
<body>
  <!-- [Previous body content remains exactly the same until the closing </div> before the scripts] -->

  <script>
    /**
     * @file Professional Dashboard Script for JaluStore
     * @version 3.0.0
     *
     * @description
     * Major improvements:
     * - Data loading from JSON file
     * - Debounced search
     * - Skeleton loading states
     * - Better error handling
     * - Performance optimizations
     */
    document.addEventListener('DOMContentLoaded', () => {
        // --- 1. Constants & Config ---
        const CONFIG = {
            DATA_URL: 'data.json',
            DEBOUNCE_DELAY: 300,
            CLOUD_COUNT: 12,
            HEART_COUNT: 25,
            ANIMATION_INTERVAL: 500
        };

        // --- 2. DOM Elements ---
        const DOM = {
            liveTime: document.getElementById('live-time'),
            refreshButton: document.getElementById('refresh-button'),
            searchBox: document.getElementById('search-box'),
            searchDebounce: document.createElement('div'),
            statsContainer: document.getElementById('stats-container'),
            cardContainers: {
                slot1: document.getElementById('slot1-cards'),
                slot2: document.getElementById('slot2-cards'),
                slot3: document.getElementById('slot3-cards'),
                completed: document.getElementById('completed-cards'),
            },
            modal: {
                overlay: document.getElementById('order-modal'),
                closeButton: document.getElementById('close-modal'),
                closeBtn: document.getElementById('close-modal-btn'),
                details: document.getElementById('modal-details'),
                whatsappButton: document.getElementById('whatsapp-button'),
            },
            cloudsContainer: document.getElementById('clouds'),
            floatingElementsContainer: document.getElementById('floating-elements'),
        };

        // Add debounce indicator to search box
        DOM.searchDebounce.className = 'search-debounce';
        DOM.searchDebounce.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
        DOM.searchBox.parentElement.appendChild(DOM.searchDebounce);

        // --- 3. Application State ---
        const state = {
            deliveryData: [],
            filteredData: [],
            searchTerm: '',
            isLoading: false,
            stats: {
                total: 0,
                completed: 0,
                pending: 0,
                failed: 0
            }
        };

        // --- 4. Helper Functions ---

        /**
         * Debounce function to limit how often a function is called
         */
        const debounce = (func, delay) => {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        };

        /**
         * Format number with thousands separator
         */
        const formatNumber = (num) => {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        };

        /**
         * Show skeleton loading state
         */
        const showSkeletonLoading = () => {
            const skeletonHTML = `
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            `;
            
            Object.values(DOM.cardContainers).forEach(container => {
                container.innerHTML = skeletonHTML;
                container.parentElement.style.display = 'block';
            });
        };

        // --- 5. Core Functions ---

        /**
         * Load data from JSON file
         */
        const loadData = async () => {
            state.isLoading = true;
            DOM.refreshButton.classList.add('loading');
            showSkeletonLoading();

            try {
                const response = await fetch(`${CONFIG.DATA_URL}?t=${Date.now()}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                state.deliveryData = data;
                filterData();
                calculateStats();
                renderDashboard();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showErrorState('Gagal memuat data. Silakan coba refresh.');
            } finally {
                state.isLoading = false;
                DOM.refreshButton.classList.remove('loading');
            }
        };

        /**
         * Filter data based on search term
         */
        const filterData = () => {
            if (!state.searchTerm) {
                state.filteredData = [...state.deliveryData];
                return;
            }

            const term = state.searchTerm.toLowerCase();
            state.filteredData = state.deliveryData.filter(item => {
                return (
                    item.name.toLowerCase().includes(term) ||
                    String(item.order).includes(term) ||
                    String(item.send).includes(term)
                );
            });
        };

        /**
         * Calculate dashboard statistics
         */
        const calculateStats = () => {
            const stats = { completed: 0, pending: 0, failed: 0 };
            
            state.deliveryData.forEach(item => {
                const status = getStatusInfo(item);
                if (status.class === 'done') stats.completed++;
                else if (status.class === 'fail') stats.failed++;
                else stats.pending++;
            });

            state.stats = {
                total: state.deliveryData.length,
                ...stats
            };
        };

        /**
         * Determine status information for an item
         */
        const getStatusInfo = (item) => {
            if (item.statusOverride === 'fail') {
                return { class: 'fail', text: 'Gagal', icon: 'fa-times-circle', showProgress: true };
            }
            if (item.statusOverride === 'pending') {
                return { class: 'pending', text: 'Proses', icon: 'fa-hourglass-half', showProgress: true };
            }
            if (item.slot === 'completed' || item.send >= item.order) {
                return { class: 'done', text: 'Selesai', icon: 'fa-check-circle', showProgress: false };
            }
            return { class: 'pending', text: 'Proses', icon: 'fa-hourglass-half', showProgress: true };
        };

        /**
         * Render the entire dashboard
         */
        const renderDashboard = () => {
            renderStats();
            renderCards();
        };

        /**
         * Render statistics cards
         */
        const renderStats = () => {
            DOM.statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(state.stats.total)}</div>
                    <div class="stat-label">Total Order</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(state.stats.completed)}</div>
                    <div class="stat-label">Selesai</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(state.stats.pending)}</div>
                    <div class="stat-label">Proses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${formatNumber(state.stats.failed)}</div>
                    <div class="stat-label">Gagal</div>
                </div>
            `;
        };

        /**
         * Render all order cards
         */
        const renderCards = () => {
            // Clear containers first
            Object.values(DOM.cardContainers).forEach(container => {
                container.innerHTML = '';
                container.parentElement.style.display = 'none';
            });

            // Show message if no results
            if (state.searchTerm && state.filteredData.length === 0) {
                DOM.cardContainers.slot1.innerHTML = `
                    <div class="card-placeholder">
                        Tidak ditemukan hasil untuk "${state.searchTerm}"
                    </div>
                `;
                DOM.cardContainers.slot1.parentElement.style.display = 'block';
                return;
            }

            // Group items by slot
            const groupedItems = { 1: [], 2: [], 3: [], completed: [] };
            
            state.filteredData.forEach(item => {
                const status = getStatusInfo(item);
                const targetSlot = status.class === 'done' ? 'completed' : String(item.slot);
                groupedItems[targetSlot]?.push(item);
            });

            // Render each group
            for (const [slot, items] of Object.entries(groupedItems)) {
                if (items.length === 0) continue;
                
                const container = DOM.cardContainers[slot];
                const section = container?.parentElement;
                if (!container || !section) continue;
                
                container.innerHTML = items.map(item => createCardElement(item)).join('');
                section.style.display = 'block';
            }
        };

        /**
         * Create a card element for an order item
         */
        const createCardElement = (item) => {
            const status = getStatusInfo(item);
            const progressPercent = Math.min((item.send / item.order) * 100, 100);
            const progressBar = status.showProgress ? `
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" style="width: ${progressPercent}%;"></div>
                </div>
            ` : '';

            return `
                <div class="card ${status.class}" data-id="${item.name}">
                    <div class="name">${item.name}</div>
                    <div class="number">Order: ${formatNumber(item.order)} | Terkirim: ${formatNumber(item.send)}</div>
                    <div class="status ${status.class}">
                        <i class="fas ${status.icon}"></i> ${status.text}
                    </div>
                    ${progressBar}
                </div>
            `;
        };

        /**
         * Show error state in the UI
         */
        const showErrorState = (message) => {
            DOM.cardContainers.slot1.innerHTML = `
                <div class="card-placeholder error">
                    <i class="fas fa-exclamation-circle"></i>
                    ${message}
                </div>
            `;
            DOM.cardContainers.slot1.parentElement.style.display = 'block';
        };

        // --- 6. UI Functions ---

        /**
         * Update the live time display
         */
        const updateLiveTime = () => {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                timeZone: 'Asia/Jakarta'
            };
            
            DOM.liveTime.textContent = now.toLocaleDateString('id-ID', options);
        };

        /**
         * Open order details modal
         */
        const openOrderModal = (item) => {
            const status = getStatusInfo(item);
            const progress = (item.order > 0) ? (item.send / item.order) * 100 : 0;
            const remaining = item.order - item.send;

            DOM.modal.details.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Nama</div>
                    <div class="detail-value">${item.name}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Jumlah Order</div>
                    <div class="detail-value">${formatNumber(item.order)} Heart</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Terkirim</div>
                    <div class="detail-value">${formatNumber(item.send)} Heart</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Sisa</div>
                    <div class="detail-value">${formatNumber(remaining)} Heart</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Status</div>
                    <div class="detail-value">${status.text}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Progress</div>
                    <div class="detail-value">${progress.toFixed(1)}%</div>
                </div>
            `;

            // Show WhatsApp button if number exists
            if (item.number) {
                DOM.modal.whatsappButton.style.display = 'inline-block';
                const whatsappLink = `https://wa.me/${item.number.replace(/\D/g, '')}?text=${encodeURIComponent(
                    `Halo ${item.name}, ini update orderan heart Anda:\n\n` +
                    `🛒 Total Order: ${item.order} Heart\n` +
                    `📦 Terkirim: ${item.send} Heart\n` +
                    `⏳ Sisa: ${remaining} Heart\n` +
                    `📊 Progress: ${progress.toFixed(1)}%\n\n` +
                    `Status: ${status.text}`
                )}`;
                DOM.modal.whatsappButton.onclick = () => window.open(whatsappLink, '_blank');
            } else {
                DOM.modal.whatsappButton.style.display = 'none';
            }

            DOM.modal.overlay.classList.add('active');
        };

        /**
         * Close order details modal
         */
        const closeOrderModal = () => {
            DOM.modal.overlay.classList.remove('active');
        };

        // --- 7. Event Handlers ---

        /**
         * Handle search input with debouncing
         */
        const handleSearchInput = debounce((e) => {
            state.searchTerm = e.target.value.trim();
            DOM.searchDebounce.classList.remove('visible');
            filterData();
            renderDashboard();
        }, CONFIG.DEBOUNDE_DELAY);

        /**
         * Handle card click to show details
         */
        const handleCardClick = (e) => {
            const card = e.target.closest('.card');
            if (!card) return;
            
            const itemName = card.dataset.id;
            const item = state.filteredData.find(d => d.name === itemName);
            if (item) openOrderModal(item);
        };

        // --- 8. Animation Functions ---

        /**
         * Create decorative cloud elements
         */
        const createClouds = () => {
            for (let i = 0; i < CONFIG.CLOUD_COUNT; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                
                const size = Math.random() * 100 + 50;
                cloud.style.cssText = `
                    width: ${size}px;
                    height: ${size * 0.6}px;
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    animation-duration: ${Math.random() * 30 + 20}s;
                    animation-delay: ${Math.random() * 10}s;
                    filter: blur(${Math.random() * 3}px);
                    opacity: ${Math.random() * 0.4 + 0.3};
                `;
                
                DOM.cloudsContainer.appendChild(cloud);
            }
        };

        /**
         * Create floating heart elements
         */
        const createFloatingHearts = () => {
            for (let i = 0; i < CONFIG.HEART_COUNT; i++) {
                const heart = document.createElement('i');
                heart.className = 'fas fa-heart heart';
                
                heart.style.cssText = `
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    font-size: ${Math.random() * 20 + 10}px;
                    animation-duration: ${Math.random() * 5 + 3}s;
                    animation-delay: ${Math.random() * 5}s;
                    opacity: ${Math.random() * 0.5 + 0.3};
                    color: hsl(${Math.random() * 60 + 330}, 100%, 70%);
                `;
                
                DOM.floatingElementsContainer.appendChild(heart);
            }
        };

        // --- 9. Initialization ---

        /**
         * Initialize the application
         */
        const init = () => {
            // Setup event listeners
            DOM.refreshButton.addEventListener('click', loadData);
            DOM.searchBox.addEventListener('input', (e) => {
                DOM.searchDebounce.classList.add('visible');
                handleSearchInput(e);
            });
            
            DOM.modal.closeButton.addEventListener('click', closeOrderModal);
            DOM.modal.closeBtn.addEventListener('click', closeOrderModal);
            DOM.modal.overlay.addEventListener('click', (e) => {
                if (e.target === DOM.modal.overlay) closeOrderModal();
            });

            // Use event delegation for card clicks
            Object.values(DOM.cardContainers).forEach(container => {
                container.addEventListener('click', handleCardClick);
            });

            // Initialize animations
            createClouds();
            createFloatingHearts();
            
            // Start live clock
            updateLiveTime();
            setInterval(updateLiveTime, 1000);

            // Load initial data
            loadData();
        };

        // Start the application
        init();
    });
  </script>
</body>
</html>
